import{r as p,j as V}from"./react-BWZE0YoS.js";import{L as Re,T as Be,R as qt,U as Vt,a as Xt,O as qe,P as Ve,S as rt,b as Oe,N as Yt,A as Zt,B as Kt,M as Jt,C as Qt,V as q,c as ht,W as er,d as tr,e as rr,f as nr,g as or,h as ir,i as sr,D as ar,j as _e,k as Xe,l as lr,m as cr,E as gt,n as ur,o as fr,p as dr,q as ue,r as pr,s as mr,t as vr}from"./three-sfXiOdQa.js";import{u as hr}from"./react-use-measure-DP9Bg8_z.js";import{F as gr,u as yr}from"./its-fine-Cz1mrY8n.js";import{R as br,c as ce}from"./react-reconciler-BMyoKeNz.js";import{_ as J}from"./@babel-CF3RwP-h.js";import{c as wr}from"./react-dom--BBZ98Qy.js";import{c as yt}from"./zustand-D2z5PuYh.js";import"./maath-BDD4EQm1.js";import{D as _r,G as Ye,a as Er,M as je,O as Pr}from"./three-stdlib-C0BLHN4v.js";import{s as Mr,p as xr,c as Cr}from"./suspend-react-BKIKQNXN.js";function xn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Cn(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var c=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(r,i,c.get?c:{enumerable:!0,get:function(){return e[i]}})}),r}const Sr="modulepreload",Rr=function(e){return"/"+e},nt={},Sn=function(t,r,i){let c=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),d=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));c=Promise.allSettled(r.map(s=>{if(s=Rr(s),s in nt)return;nt[s]=!0;const v=s.endsWith(".css"),o=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${o}`))return;const n=document.createElement("link");if(n.rel=v?"stylesheet":Sr,v||(n.as="script"),n.crossOrigin="",n.href=s,d&&n.setAttribute("nonce",d),document.head.appendChild(n),v)return new Promise((l,m)=>{n.addEventListener("load",l),n.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${s}`)))})}))}function a(f){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=f,window.dispatchEvent(d),!d.defaultPrevented)throw f}return c.then(f=>{for(const d of f||[])d.status==="rejected"&&a(d.reason);return t().catch(a)})};var bt={exports:{}},wt={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(b,C){var P=b.length;b.push(C);e:for(;0<P;){var S=P-1>>>1,A=b[S];if(0<c(A,C))b[S]=C,b[P]=A,P=S;else break e}}function r(b){return b.length===0?null:b[0]}function i(b){if(b.length===0)return null;var C=b[0],P=b.pop();if(P!==C){b[0]=P;e:for(var S=0,A=b.length,j=A>>>1;S<j;){var $=2*(S+1)-1,N=b[$],Y=$+1,oe=b[Y];if(0>c(N,P))Y<A&&0>c(oe,N)?(b[S]=oe,b[Y]=P,S=Y):(b[S]=N,b[$]=P,S=$);else if(Y<A&&0>c(oe,P))b[S]=oe,b[Y]=P,S=Y;else break e}}return C}function c(b,C){var P=b.sortIndex-C.sortIndex;return P!==0?P:b.id-C.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var f=Date,d=f.now();e.unstable_now=function(){return f.now()-d}}var s=[],v=[],o=1,n=null,l=3,m=!1,g=!1,E=!1,y=typeof setTimeout=="function"?setTimeout:null,u=typeof clearTimeout=="function"?clearTimeout:null,h=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function M(b){for(var C=r(v);C!==null;){if(C.callback===null)i(v);else if(C.startTime<=b)i(v),C.sortIndex=C.expirationTime,t(s,C);else break;C=r(v)}}function O(b){if(E=!1,M(b),!g)if(r(s)!==null)g=!0,B(x);else{var C=r(v);C!==null&&W(O,C.startTime-b)}}function x(b,C){g=!1,E&&(E=!1,u(k),k=-1),m=!0;var P=l;try{for(M(C),n=r(s);n!==null&&(!(n.expirationTime>C)||b&&!w());){var S=n.callback;if(typeof S=="function"){n.callback=null,l=n.priorityLevel;var A=S(n.expirationTime<=C);C=e.unstable_now(),typeof A=="function"?n.callback=A:n===r(s)&&i(s),M(C)}else i(s);n=r(s)}if(n!==null)var j=!0;else{var $=r(v);$!==null&&W(O,$.startTime-C),j=!1}return j}finally{n=null,l=P,m=!1}}var _=!1,T=null,k=-1,R=5,D=-1;function w(){return!(e.unstable_now()-D<R)}function L(){if(T!==null){var b=e.unstable_now();D=b;var C=!0;try{C=T(!0,b)}finally{C?H():(_=!1,T=null)}}else _=!1}var H;if(typeof h=="function")H=function(){h(L)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,z=X.port2;X.port1.onmessage=L,H=function(){z.postMessage(null)}}else H=function(){y(L,0)};function B(b){T=b,_||(_=!0,H())}function W(b,C){k=y(function(){b(e.unstable_now())},C)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(b){b.callback=null},e.unstable_continueExecution=function(){g||m||(g=!0,B(x))},e.unstable_forceFrameRate=function(b){0>b||125<b?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<b?Math.floor(1e3/b):5},e.unstable_getCurrentPriorityLevel=function(){return l},e.unstable_getFirstCallbackNode=function(){return r(s)},e.unstable_next=function(b){switch(l){case 1:case 2:case 3:var C=3;break;default:C=l}var P=l;l=C;try{return b()}finally{l=P}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(b,C){switch(b){case 1:case 2:case 3:case 4:case 5:break;default:b=3}var P=l;l=b;try{return C()}finally{l=P}},e.unstable_scheduleCallback=function(b,C,P){var S=e.unstable_now();switch(typeof P=="object"&&P!==null?(P=P.delay,P=typeof P=="number"&&0<P?S+P:S):P=S,b){case 1:var A=-1;break;case 2:A=250;break;case 5:A=1073741823;break;case 4:A=1e4;break;default:A=5e3}return A=P+A,b={id:o++,callback:C,priorityLevel:b,startTime:P,expirationTime:A,sortIndex:-1},P>S?(b.sortIndex=P,t(v,b),r(s)===null&&b===r(v)&&(E?(u(k),k=-1):E=!0,W(O,P-S))):(b.sortIndex=A,t(s,b),g||m||(g=!0,B(x))),b},e.unstable_shouldYield=w,e.unstable_wrapCallback=function(b){var C=l;return function(){var P=l;l=C;try{return b.apply(this,arguments)}finally{l=P}}}})(wt);bt.exports=wt;var ot=bt.exports;const Ze={},Or=e=>void Object.assign(Ze,e);function jr(e,t){function r(o,{args:n=[],attach:l,...m},g){let E=`${o[0].toUpperCase()}${o.slice(1)}`,y;if(o==="primitive"){if(m.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const u=m.object;y=ae(u,{type:o,root:g,attach:l,primitive:!0})}else{const u=Ze[E];if(!u)throw new Error(`R3F: ${E} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(n))throw new Error("R3F: The args prop must be an array!");y=ae(new u(...n),{type:o,root:g,attach:l,memoizedProps:{args:n}})}return y.__r3f.attach===void 0&&(y instanceof Kt?y.__r3f.attach="geometry":y instanceof Jt&&(y.__r3f.attach="material")),E!=="inject"&&ke(y,m),y}function i(o,n){let l=!1;if(n){var m,g;(m=n.__r3f)!=null&&m.attach?Ae(o,n,n.__r3f.attach):n.isObject3D&&o.isObject3D&&(o.add(n),l=!0),l||(g=o.__r3f)==null||g.objects.push(n),n.__r3f||ae(n,{}),n.__r3f.parent=o,Ue(n),le(n)}}function c(o,n,l){let m=!1;if(n){var g,E;if((g=n.__r3f)!=null&&g.attach)Ae(o,n,n.__r3f.attach);else if(n.isObject3D&&o.isObject3D){n.parent=o,n.dispatchEvent({type:"added"}),o.dispatchEvent({type:"childadded",child:n});const y=o.children.filter(h=>h!==n),u=y.indexOf(l);o.children=[...y.slice(0,u),n,...y.slice(u)],m=!0}m||(E=o.__r3f)==null||E.objects.push(n),n.__r3f||ae(n,{}),n.__r3f.parent=o,Ue(n),le(n)}}function a(o,n,l=!1){o&&[...o].forEach(m=>f(n,m,l))}function f(o,n,l){if(n){var m,g,E;if(n.__r3f&&(n.__r3f.parent=null),(m=o.__r3f)!=null&&m.objects&&(o.__r3f.objects=o.__r3f.objects.filter(O=>O!==n)),(g=n.__r3f)!=null&&g.attach)ct(o,n,n.__r3f.attach);else if(n.isObject3D&&o.isObject3D){var y;o.remove(n),(y=n.__r3f)!=null&&y.root&&Wr(xe(n),n)}const h=(E=n.__r3f)==null?void 0:E.primitive,M=!h&&(l===void 0?n.dispose!==null:l);if(!h){var u;a((u=n.__r3f)==null?void 0:u.objects,n,M),a(n.children,n,M)}if(delete n.__r3f,M&&n.dispose&&n.type!=="Scene"){const O=()=>{try{n.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?ot.unstable_scheduleCallback(ot.unstable_IdlePriority,O):O()}le(o)}}function d(o,n,l,m){var g;const E=(g=o.__r3f)==null?void 0:g.parent;if(!E)return;const y=r(n,l,o.__r3f.root);if(o.children){for(const u of o.children)u.__r3f&&i(y,u);o.children=o.children.filter(u=>!u.__r3f)}o.__r3f.objects.forEach(u=>i(y,u)),o.__r3f.objects=[],o.__r3f.autoRemovedBeforeAppend||f(E,o),y.parent&&(y.__r3f.autoRemovedBeforeAppend=!0),i(E,y),y.raycast&&y.__r3f.eventCount&&xe(y).getState().internal.interaction.push(y),[m,m.alternate].forEach(u=>{u!==null&&(u.stateNode=y,u.ref&&(typeof u.ref=="function"?u.ref(y):u.ref.current=y))})}const s=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:br({createInstance:r,removeChild:f,appendChild:i,appendInitialChild:i,insertBefore:c,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(o,n)=>{if(!n)return;const l=o.getState().scene;l.__r3f&&(l.__r3f.root=o,i(l,n))},removeChildFromContainer:(o,n)=>{n&&f(o.getState().scene,n)},insertInContainerBefore:(o,n,l)=>{if(!n||!l)return;const m=o.getState().scene;m.__r3f&&c(m,n,l)},getRootHostContext:()=>null,getChildHostContext:o=>o,finalizeInitialChildren(o){var n;return!!((n=o==null?void 0:o.__r3f)!=null?n:{}).handlers},prepareUpdate(o,n,l,m){var g;if(((g=o==null?void 0:o.__r3f)!=null?g:{}).primitive&&m.object&&m.object!==o)return[!0];{const{args:y=[],children:u,...h}=m,{args:M=[],children:O,...x}=l;if(!Array.isArray(y))throw new Error("R3F: the args prop must be an array!");if(y.some((T,k)=>T!==M[k]))return[!0];const _=St(o,h,x,!0);return _.changes.length?[!1,_]:null}},commitUpdate(o,[n,l],m,g,E,y){n?d(o,m,E,y):ke(o,l)},commitMount(o,n,l,m){var g;const E=(g=o.__r3f)!=null?g:{};o.raycast&&E.handlers&&E.eventCount&&xe(o).getState().internal.interaction.push(o)},getPublicInstance:o=>o,prepareForCommit:()=>null,preparePortalMount:o=>ae(o.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(o){var n;const{attach:l,parent:m}=(n=o.__r3f)!=null?n:{};l&&m&&ct(m,o,l),o.isObject3D&&(o.visible=!1),le(o)},unhideInstance(o,n){var l;const{attach:m,parent:g}=(l=o.__r3f)!=null?l:{};m&&g&&Ae(g,o,m),(o.isObject3D&&n.visible==null||n.visible)&&(o.visible=!0),le(o)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>t?t():ce.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&I.fun(performance.now)?performance.now:I.fun(Date.now)?Date.now:()=>0,scheduleTimeout:I.fun(setTimeout)?setTimeout:void 0,cancelTimeout:I.fun(clearTimeout)?clearTimeout:void 0}),applyProps:ke}}var it,st;const Te=e=>"colorSpace"in e||"outputColorSpace"in e,_t=()=>{var e;return(e=Ze.ColorManagement)!=null?e:null},Et=e=>e&&e.isOrthographicCamera,Tr=e=>e&&e.hasOwnProperty("current"),ge=typeof window<"u"&&((it=window.document)!=null&&it.createElement||((st=window.navigator)==null?void 0:st.product)==="ReactNative")?p.useLayoutEffect:p.useEffect;function Pt(e){const t=p.useRef(e);return ge(()=>void(t.current=e),[e]),t}function Ar({set:e}){return ge(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Mt extends p.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}Mt.getDerivedStateFromError=()=>({error:!0});const xt="__default",at=new Map,kr=e=>e&&!!e.memoized&&!!e.changes;function Ct(e){var t;const r=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],r),e[1]):e}const pe=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function xe(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const I={obj:e=>e===Object(e)&&!I.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:r="shallow",objects:i="reference",strict:c=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(I.str(e)||I.num(e))return e===t;const a=I.obj(e);if(a&&i==="reference")return e===t;const f=I.arr(e);if(f&&r==="reference")return e===t;if((f||a)&&e===t)return!0;let d;for(d in e)if(!(d in t))return!1;if(a&&r==="shallow"&&i==="shallow"){for(d in c?t:e)if(!I.equ(e[d],t[d],{strict:c,objects:"reference"}))return!1}else for(d in c?t:e)if(e[d]!==t[d])return!1;if(I.und(d)){if(f&&e.length===0&&t.length===0||a&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Lr(e){const t={nodes:{},materials:{}};return e&&e.traverse(r=>{r.name&&(t.nodes[r.name]=r),r.material&&!t.materials[r.material.name]&&(t.materials[r.material.name]=r.material)}),t}function Dr(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function ae(e,t){const r=e;return r.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Ne(e,t){let r=e;if(t.includes("-")){const i=t.split("-"),c=i.pop();return r=i.reduce((a,f)=>a[f],e),{target:r,key:c}}else return{target:r,key:t}}const lt=/-\d+$/;function Ae(e,t,r){if(I.str(r)){if(lt.test(r)){const a=r.replace(lt,""),{target:f,key:d}=Ne(e,a);Array.isArray(f[d])||(f[d]=[])}const{target:i,key:c}=Ne(e,r);t.__r3f.previousAttach=i[c],i[c]=t}else t.__r3f.previousAttach=r(e,t)}function ct(e,t,r){var i,c;if(I.str(r)){const{target:a,key:f}=Ne(e,r),d=t.__r3f.previousAttach;d===void 0?delete a[f]:a[f]=d}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(c=t.__r3f)==null||delete c.previousAttach}function St(e,{children:t,key:r,ref:i,...c},{children:a,key:f,ref:d,...s}={},v=!1){const o=e.__r3f,n=Object.entries(c),l=[];if(v){const g=Object.keys(s);for(let E=0;E<g.length;E++)c.hasOwnProperty(g[E])||n.unshift([g[E],xt+"remove"])}n.forEach(([g,E])=>{var y;if((y=e.__r3f)!=null&&y.primitive&&g==="object"||I.equ(E,s[g]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(g))return l.push([g,E,!0,[]]);let u=[];g.includes("-")&&(u=g.split("-")),l.push([g,E,!1,u]);for(const h in c){const M=c[h];h.startsWith(`${g}-`)&&l.push([h,M,!1,h.split("-")])}});const m={...c};return o!=null&&o.memoizedProps&&o!=null&&o.memoizedProps.args&&(m.args=o.memoizedProps.args),o!=null&&o.memoizedProps&&o!=null&&o.memoizedProps.attach&&(m.attach=o.memoizedProps.attach),{memoized:m,changes:l}}const Fr=typeof process<"u"&&!1;function ke(e,t){var r;const i=e.__r3f,c=i==null?void 0:i.root,a=c==null||c.getState==null?void 0:c.getState(),{memoized:f,changes:d}=kr(t)?t:St(e,t),s=i==null?void 0:i.eventCount;e.__r3f&&(e.__r3f.memoizedProps=f);for(let o=0;o<d.length;o++){let[n,l,m,g]=d[o];if(Te(e)){const h="srgb",M="srgb-linear";n==="encoding"?(n="colorSpace",l=l===3001?h:M):n==="outputEncoding"&&(n="outputColorSpace",l=l===3001?h:M)}let E=e,y=E[n];if(g.length&&(y=g.reduce((u,h)=>u[h],e),!(y&&y.set))){const[u,...h]=g.reverse();E=h.reverse().reduce((M,O)=>M[O],e),n=u}if(l===xt+"remove")if(E.constructor){let u=at.get(E.constructor);u||(u=new E.constructor,at.set(E.constructor,u)),l=u[n]}else l=0;if(m&&i)l?i.handlers[n]=l:delete i.handlers[n],i.eventCount=Object.keys(i.handlers).length;else if(y&&y.set&&(y.copy||y instanceof Re)){if(Array.isArray(l))y.fromArray?y.fromArray(l):y.set(...l);else if(y.copy&&l&&l.constructor&&(Fr?y.constructor.name===l.constructor.name:y.constructor===l.constructor))y.copy(l);else if(l!==void 0){const u=y instanceof Qt;!u&&y.setScalar?y.setScalar(l):y instanceof Re&&l instanceof Re?y.mask=l.mask:y.set(l),!_t()&&a&&!a.linear&&u&&y.convertSRGBToLinear()}}else if(E[n]=l,E[n]instanceof Be&&E[n].format===qt&&E[n].type===Vt&&a){const u=E[n];Te(u)&&Te(a.gl)?u.colorSpace=a.gl.outputColorSpace:u.encoding=a.gl.outputEncoding}le(e)}if(i&&i.parent&&e.raycast&&s!==i.eventCount){const o=xe(e).getState().internal,n=o.interaction.indexOf(e);n>-1&&o.interaction.splice(n,1),i.eventCount&&o.interaction.push(e)}return!(d.length===1&&d[0][0]==="onUpdate")&&d.length&&(r=e.__r3f)!=null&&r.parent&&Ue(e),e}function le(e){var t,r;const i=(t=e.__r3f)==null||(r=t.root)==null||r.getState==null?void 0:r.getState();i&&i.internal.frames===0&&i.invalidate()}function Ue(e){e.onUpdate==null||e.onUpdate(e)}function Ir(e,t){e.manual||(Et(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function Ee(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function zr(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return ce.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ce.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ce.ContinuousEventPriority;default:return ce.DefaultEventPriority}}function Rt(e,t,r,i){const c=r.get(t);c&&(r.delete(t),r.size===0&&(e.delete(i),c.target.releasePointerCapture(i)))}function Wr(e,t){const{internal:r}=e.getState();r.interaction=r.interaction.filter(i=>i!==t),r.initialHits=r.initialHits.filter(i=>i!==t),r.hovered.forEach((i,c)=>{(i.eventObject===t||i.object===t)&&r.hovered.delete(c)}),r.capturedMap.forEach((i,c)=>{Rt(r.capturedMap,t,i,c)})}function Hr(e){function t(s){const{internal:v}=e.getState(),o=s.offsetX-v.initialClick[0],n=s.offsetY-v.initialClick[1];return Math.round(Math.sqrt(o*o+n*n))}function r(s){return s.filter(v=>["Move","Over","Enter","Out","Leave"].some(o=>{var n;return(n=v.__r3f)==null?void 0:n.handlers["onPointer"+o]}))}function i(s,v){const o=e.getState(),n=new Set,l=[],m=v?v(o.internal.interaction):o.internal.interaction;for(let u=0;u<m.length;u++){const h=pe(m[u]);h&&(h.raycaster.camera=void 0)}o.previousRoot||o.events.compute==null||o.events.compute(s,o);function g(u){const h=pe(u);if(!h||!h.events.enabled||h.raycaster.camera===null)return[];if(h.raycaster.camera===void 0){var M;h.events.compute==null||h.events.compute(s,h,(M=h.previousRoot)==null?void 0:M.getState()),h.raycaster.camera===void 0&&(h.raycaster.camera=null)}return h.raycaster.camera?h.raycaster.intersectObject(u,!0):[]}let E=m.flatMap(g).sort((u,h)=>{const M=pe(u.object),O=pe(h.object);return!M||!O?u.distance-h.distance:O.events.priority-M.events.priority||u.distance-h.distance}).filter(u=>{const h=Ee(u);return n.has(h)?!1:(n.add(h),!0)});o.events.filter&&(E=o.events.filter(E,o));for(const u of E){let h=u.object;for(;h;){var y;(y=h.__r3f)!=null&&y.eventCount&&l.push({...u,eventObject:h}),h=h.parent}}if("pointerId"in s&&o.internal.capturedMap.has(s.pointerId))for(let u of o.internal.capturedMap.get(s.pointerId).values())n.has(Ee(u.intersection))||l.push(u.intersection);return l}function c(s,v,o,n){const l=e.getState();if(s.length){const m={stopped:!1};for(const g of s){const E=pe(g.object)||l,{raycaster:y,pointer:u,camera:h,internal:M}=E,O=new q(u.x,u.y,0).unproject(h),x=D=>{var w,L;return(w=(L=M.capturedMap.get(D))==null?void 0:L.has(g.eventObject))!=null?w:!1},_=D=>{const w={intersection:g,target:v.target};M.capturedMap.has(D)?M.capturedMap.get(D).set(g.eventObject,w):M.capturedMap.set(D,new Map([[g.eventObject,w]])),v.target.setPointerCapture(D)},T=D=>{const w=M.capturedMap.get(D);w&&Rt(M.capturedMap,g.eventObject,w,D)};let k={};for(let D in v){let w=v[D];typeof w!="function"&&(k[D]=w)}let R={...g,...k,pointer:u,intersections:s,stopped:m.stopped,delta:o,unprojectedPoint:O,ray:y.ray,camera:h,stopPropagation(){const D="pointerId"in v&&M.capturedMap.get(v.pointerId);if((!D||D.has(g.eventObject))&&(R.stopped=m.stopped=!0,M.hovered.size&&Array.from(M.hovered.values()).find(w=>w.eventObject===g.eventObject))){const w=s.slice(0,s.indexOf(g));a([...w,g])}},target:{hasPointerCapture:x,setPointerCapture:_,releasePointerCapture:T},currentTarget:{hasPointerCapture:x,setPointerCapture:_,releasePointerCapture:T},nativeEvent:v};if(n(R),m.stopped===!0)break}}return s}function a(s){const{internal:v}=e.getState();for(const o of v.hovered.values())if(!s.length||!s.find(n=>n.object===o.object&&n.index===o.index&&n.instanceId===o.instanceId)){const l=o.eventObject.__r3f,m=l==null?void 0:l.handlers;if(v.hovered.delete(Ee(o)),l!=null&&l.eventCount){const g={...o,intersections:s};m.onPointerOut==null||m.onPointerOut(g),m.onPointerLeave==null||m.onPointerLeave(g)}}}function f(s,v){for(let o=0;o<v.length;o++){const n=v[o].__r3f;n==null||n.handlers.onPointerMissed==null||n.handlers.onPointerMissed(s)}}function d(s){switch(s){case"onPointerLeave":case"onPointerCancel":return()=>a([]);case"onLostPointerCapture":return v=>{const{internal:o}=e.getState();"pointerId"in v&&o.capturedMap.has(v.pointerId)&&requestAnimationFrame(()=>{o.capturedMap.has(v.pointerId)&&(o.capturedMap.delete(v.pointerId),a([]))})}}return function(o){const{onPointerMissed:n,internal:l}=e.getState();l.lastEvent.current=o;const m=s==="onPointerMove",g=s==="onClick"||s==="onContextMenu"||s==="onDoubleClick",y=i(o,m?r:void 0),u=g?t(o):0;s==="onPointerDown"&&(l.initialClick=[o.offsetX,o.offsetY],l.initialHits=y.map(M=>M.eventObject)),g&&!y.length&&u<=2&&(f(o,l.interaction),n&&n(o)),m&&a(y);function h(M){const O=M.eventObject,x=O.__r3f,_=x==null?void 0:x.handlers;if(x!=null&&x.eventCount)if(m){if(_.onPointerOver||_.onPointerEnter||_.onPointerOut||_.onPointerLeave){const T=Ee(M),k=l.hovered.get(T);k?k.stopped&&M.stopPropagation():(l.hovered.set(T,M),_.onPointerOver==null||_.onPointerOver(M),_.onPointerEnter==null||_.onPointerEnter(M))}_.onPointerMove==null||_.onPointerMove(M)}else{const T=_[s];T?(!g||l.initialHits.includes(O))&&(f(o,l.interaction.filter(k=>!l.initialHits.includes(k))),T(M)):g&&l.initialHits.includes(O)&&f(o,l.interaction.filter(k=>!l.initialHits.includes(k)))}}c(y,o,u,h)}}return{handlePointer:d}}const Ot=e=>!!(e!=null&&e.render),jt=p.createContext(null),$r=(e,t)=>{const r=yt((d,s)=>{const v=new q,o=new q,n=new q;function l(u=s().camera,h=o,M=s().size){const{width:O,height:x,top:_,left:T}=M,k=O/x;h instanceof q?n.copy(h):n.set(...h);const R=u.getWorldPosition(v).distanceTo(n);if(Et(u))return{width:O/u.zoom,height:x/u.zoom,top:_,left:T,factor:1,distance:R,aspect:k};{const D=u.fov*Math.PI/180,w=2*Math.tan(D/2)*R,L=w*(O/x);return{width:L,height:w,top:_,left:T,factor:O/L,distance:R,aspect:k}}}let m;const g=u=>d(h=>({performance:{...h.performance,current:u}})),E=new ht;return{set:d,get:s,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(u=1)=>e(s(),u),advance:(u,h)=>t(u,h,s()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new ir,pointer:E,mouse:E,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const u=s();m&&clearTimeout(m),u.performance.current!==u.performance.min&&g(u.performance.min),m=setTimeout(()=>g(s().performance.max),u.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:l},setEvents:u=>d(h=>({...h,events:{...h.events,...u}})),setSize:(u,h,M,O,x)=>{const _=s().camera,T={width:u,height:h,top:O||0,left:x||0,updateStyle:M};d(k=>({size:T,viewport:{...k.viewport,...l(_,o,T)}}))},setDpr:u=>d(h=>{const M=Ct(u);return{viewport:{...h.viewport,dpr:M,initialDpr:h.viewport.initialDpr||M}}}),setFrameloop:(u="always")=>{const h=s().clock;h.stop(),h.elapsedTime=0,u!=="never"&&(h.start(),h.elapsedTime=0),d(()=>({frameloop:u}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:p.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(u,h,M)=>{const O=s().internal;return O.priority=O.priority+(h>0?1:0),O.subscribers.push({ref:u,priority:h,store:M}),O.subscribers=O.subscribers.sort((x,_)=>x.priority-_.priority),()=>{const x=s().internal;x!=null&&x.subscribers&&(x.priority=x.priority-(h>0?1:0),x.subscribers=x.subscribers.filter(_=>_.ref!==u))}}}}}),i=r.getState();let c=i.size,a=i.viewport.dpr,f=i.camera;return r.subscribe(()=>{const{camera:d,size:s,viewport:v,gl:o,set:n}=r.getState();if(s.width!==c.width||s.height!==c.height||v.dpr!==a){var l;c=s,a=v.dpr,Ir(d,s),o.setPixelRatio(v.dpr);const m=(l=s.updateStyle)!=null?l:typeof HTMLCanvasElement<"u"&&o.domElement instanceof HTMLCanvasElement;o.setSize(s.width,s.height,m)}d!==f&&(f=d,n(m=>({viewport:{...m.viewport,...m.viewport.getCurrentViewport(d)}})))}),r.subscribe(d=>e(d)),r};let Pe,Br=new Set,Nr=new Set,Ur=new Set;function Le(e,t){if(e.size)for(const{callback:r}of e.values())r(t)}function me(e,t){switch(e){case"before":return Le(Br,t);case"after":return Le(Nr,t);case"tail":return Le(Ur,t)}}let De,Fe;function Ie(e,t,r){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),De=t.internal.subscribers,Pe=0;Pe<De.length;Pe++)Fe=De[Pe],Fe.ref.current(Fe.store.getState(),i,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Gr(e){let t=!1,r=!1,i,c,a;function f(v){c=requestAnimationFrame(f),t=!0,i=0,me("before",v),r=!0;for(const n of e.values()){var o;a=n.store.getState(),a.internal.active&&(a.frameloop==="always"||a.internal.frames>0)&&!((o=a.gl.xr)!=null&&o.isPresenting)&&(i+=Ie(v,a))}if(r=!1,me("after",v),i===0)return me("tail",v),t=!1,cancelAnimationFrame(c)}function d(v,o=1){var n;if(!v)return e.forEach(l=>d(l.store.getState(),o));(n=v.gl.xr)!=null&&n.isPresenting||!v.internal.active||v.frameloop==="never"||(o>1?v.internal.frames=Math.min(60,v.internal.frames+o):r?v.internal.frames=2:v.internal.frames=1,t||(t=!0,requestAnimationFrame(f)))}function s(v,o=!0,n,l){if(o&&me("before",v),n)Ie(v,n,l);else for(const m of e.values())Ie(v,m.store.getState());o&&me("after",v)}return{loop:f,invalidate:d,advance:s}}function Tt(){const e=p.useContext(jt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function G(e=r=>r,t){return Tt()(e,t)}function ye(e,t=0){const r=Tt(),i=r.getState().internal.subscribe,c=Pt(e);return ge(()=>i(c,t,r),[t,i,r]),null}const ut=new WeakMap;function At(e,t){return function(r,...i){let c=ut.get(r);return c||(c=new r,ut.set(r,c)),e&&e(c),Promise.all(i.map(a=>new Promise((f,d)=>c.load(a,s=>{s.scene&&Object.assign(s,Lr(s.scene)),f(s)},t,s=>d(new Error(`Could not load ${a}: ${s==null?void 0:s.message}`))))))}}function Q(e,t,r,i){const c=Array.isArray(t)?t:[t],a=Mr(At(r,i),[e,...c],{equal:I.equ});return Array.isArray(t)?a:a[0]}Q.preload=function(e,t,r){const i=Array.isArray(t)?t:[t];return xr(At(r),[e,...i])};Q.clear=function(e,t){const r=Array.isArray(t)?t:[t];return Cr([e,...r])};const fe=new Map,{invalidate:ft,advance:dt}=Gr(fe),{reconciler:Ce,applyProps:Z}=jr(fe,zr),se={objects:"shallow",strict:!1},qr=(e,t)=>{const r=typeof e=="function"?e(t):e;return Ot(r)?r:new er({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Vr(e,t){const r=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:c,top:a,left:f,updateStyle:d=r}=t;return{width:i,height:c,top:a,left:f,updateStyle:d}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:c,top:a,left:f}=e.parentElement.getBoundingClientRect();return{width:i,height:c,top:a,left:f,updateStyle:r}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:r};return{width:0,height:0,top:0,left:0}}function Xr(e){const t=fe.get(e),r=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const c=typeof reportError=="function"?reportError:console.error,a=i||$r(ft,dt),f=r||Ce.createContainer(a,ce.ConcurrentRoot,null,!1,null,"",c,null);t||fe.set(e,{fiber:f,store:a});let d,s=!1,v;return{configure(o={}){let{gl:n,size:l,scene:m,events:g,onCreated:E,shadows:y=!1,linear:u=!1,flat:h=!1,legacy:M=!1,orthographic:O=!1,frameloop:x="always",dpr:_=[1,2],performance:T,raycaster:k,camera:R,onPointerMissed:D}=o,w=a.getState(),L=w.gl;w.gl||w.set({gl:L=qr(n,e)});let H=w.raycaster;H||w.set({raycaster:H=new Xt});const{params:X,...z}=k||{};if(I.equ(z,H,se)||Z(H,{...z}),I.equ(X,H.params,se)||Z(H,{params:{...H.params,...X}}),!w.camera||w.camera===v&&!I.equ(v,R,se)){v=R;const P=R instanceof tr,S=P?R:O?new qe(0,0,0,0,.1,1e3):new Ve(75,0,.1,1e3);P||(S.position.z=5,R&&(Z(S,R),("aspect"in R||"left"in R||"right"in R||"bottom"in R||"top"in R)&&(S.manual=!0,S.updateProjectionMatrix())),!w.camera&&!(R!=null&&R.rotation)&&S.lookAt(0,0,0)),w.set({camera:S}),H.camera=S}if(!w.scene){let P;m instanceof rt?P=m:(P=new rt,m&&Z(P,m)),w.set({scene:ae(P)})}if(!w.xr){var B;const P=(j,$)=>{const N=a.getState();N.frameloop!=="never"&&dt(j,!0,N,$)},S=()=>{const j=a.getState();j.gl.xr.enabled=j.gl.xr.isPresenting,j.gl.xr.setAnimationLoop(j.gl.xr.isPresenting?P:null),j.gl.xr.isPresenting||ft(j)},A={connect(){const j=a.getState().gl;j.xr.addEventListener("sessionstart",S),j.xr.addEventListener("sessionend",S)},disconnect(){const j=a.getState().gl;j.xr.removeEventListener("sessionstart",S),j.xr.removeEventListener("sessionend",S)}};typeof((B=L.xr)==null?void 0:B.addEventListener)=="function"&&A.connect(),w.set({xr:A})}if(L.shadowMap){const P=L.shadowMap.enabled,S=L.shadowMap.type;if(L.shadowMap.enabled=!!y,I.boo(y))L.shadowMap.type=Oe;else if(I.str(y)){var W;const A={basic:rr,percentage:nr,soft:Oe,variance:or};L.shadowMap.type=(W=A[y])!=null?W:Oe}else I.obj(y)&&Object.assign(L.shadowMap,y);(P!==L.shadowMap.enabled||S!==L.shadowMap.type)&&(L.shadowMap.needsUpdate=!0)}const b=_t();b&&("enabled"in b?b.enabled=!M:"legacyMode"in b&&(b.legacyMode=M)),s||Z(L,{outputEncoding:u?3e3:3001,toneMapping:h?Yt:Zt}),w.legacy!==M&&w.set(()=>({legacy:M})),w.linear!==u&&w.set(()=>({linear:u})),w.flat!==h&&w.set(()=>({flat:h})),n&&!I.fun(n)&&!Ot(n)&&!I.equ(n,L,se)&&Z(L,n),g&&!w.events.handlers&&w.set({events:g(a)});const C=Vr(e,l);return I.equ(C,w.size,se)||w.setSize(C.width,C.height,C.updateStyle,C.top,C.left),_&&w.viewport.dpr!==Ct(_)&&w.setDpr(_),w.frameloop!==x&&w.setFrameloop(x),w.onPointerMissed||w.set({onPointerMissed:D}),T&&!I.equ(T,w.performance,se)&&w.set(P=>({performance:{...P.performance,...T}})),d=E,s=!0,this},render(o){return s||this.configure(),Ce.updateContainer(V.jsx(Yr,{store:a,children:o,onCreated:d,rootElement:e}),f,null,()=>{}),a},unmount(){kt(e)}}}function Yr({store:e,children:t,onCreated:r,rootElement:i}){return ge(()=>{const c=e.getState();c.set(a=>({internal:{...a.internal,active:!0}})),r&&r(c),e.getState().events.connected||c.events.connect==null||c.events.connect(i)},[]),V.jsx(jt.Provider,{value:e,children:t})}function kt(e,t){const r=fe.get(e),i=r==null?void 0:r.fiber;if(i){const c=r==null?void 0:r.store.getState();c&&(c.internal.active=!1),Ce.updateContainer(null,i,null,()=>{c&&setTimeout(()=>{try{var a,f,d,s;c.events.disconnect==null||c.events.disconnect(),(a=c.gl)==null||(f=a.renderLists)==null||f.dispose==null||f.dispose(),(d=c.gl)==null||d.forceContextLoss==null||d.forceContextLoss(),(s=c.gl)!=null&&s.xr&&c.xr.disconnect(),Dr(c),fe.delete(e)}catch{}},500)})}}Ce.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:p.version});const ze={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Zr(e){const{handlePointer:t}=Hr(e);return{priority:1,enabled:!0,compute(r,i,c){i.pointer.set(r.offsetX/i.size.width*2-1,-(r.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(ze).reduce((r,i)=>({...r,[i]:t(i)}),{}),update:()=>{var r;const{events:i,internal:c}=e.getState();(r=c.lastEvent)!=null&&r.current&&i.handlers&&i.handlers.onPointerMove(c.lastEvent.current)},connect:r=>{var i;const{set:c,events:a}=e.getState();a.disconnect==null||a.disconnect(),c(f=>({events:{...f.events,connected:r}})),Object.entries((i=a.handlers)!=null?i:[]).forEach(([f,d])=>{const[s,v]=ze[f];r.addEventListener(s,d,{passive:v})})},disconnect:()=>{const{set:r,events:i}=e.getState();if(i.connected){var c;Object.entries((c=i.handlers)!=null?c:[]).forEach(([a,f])=>{if(i&&i.connected instanceof HTMLElement){const[d]=ze[a];i.connected.removeEventListener(d,f)}}),r(a=>({events:{...a.events,connected:void 0}}))}}}}const Kr=p.forwardRef(function({children:t,fallback:r,resize:i,style:c,gl:a,events:f=Zr,eventSource:d,eventPrefix:s,shadows:v,linear:o,flat:n,legacy:l,orthographic:m,frameloop:g,dpr:E,performance:y,raycaster:u,camera:h,scene:M,onPointerMissed:O,onCreated:x,..._},T){p.useMemo(()=>Or(sr),[]);const k=yr(),[R,D]=hr({scroll:!0,debounce:{scroll:50,resize:0},...i}),w=p.useRef(null),L=p.useRef(null);p.useImperativeHandle(T,()=>w.current);const H=Pt(O),[X,z]=p.useState(!1),[B,W]=p.useState(!1);if(X)throw X;if(B)throw B;const b=p.useRef(null);ge(()=>{const P=w.current;D.width>0&&D.height>0&&P&&(b.current||(b.current=Xr(P)),b.current.configure({gl:a,events:f,shadows:v,linear:o,flat:n,legacy:l,orthographic:m,frameloop:g,dpr:E,performance:y,raycaster:u,camera:h,scene:M,size:D,onPointerMissed:(...S)=>H.current==null?void 0:H.current(...S),onCreated:S=>{S.events.connect==null||S.events.connect(d?Tr(d)?d.current:d:L.current),s&&S.setEvents({compute:(A,j)=>{const $=A[s+"X"],N=A[s+"Y"];j.pointer.set($/j.size.width*2-1,-(N/j.size.height)*2+1),j.raycaster.setFromCamera(j.pointer,j.camera)}}),x==null||x(S)}}),b.current.render(V.jsx(k,{children:V.jsx(Mt,{set:W,children:V.jsx(p.Suspense,{fallback:V.jsx(Ar,{set:z}),children:t})})})))}),p.useEffect(()=>{const P=w.current;if(P)return()=>kt(P)},[]);const C=d?"none":"auto";return V.jsx("div",{ref:L,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:C,...c},..._,children:V.jsx("div",{ref:R,style:{width:"100%",height:"100%"},children:V.jsx("canvas",{ref:w,style:{display:"block"},children:r})})})}),Rn=p.forwardRef(function(t,r){return V.jsx(gr,{children:V.jsx(Kr,{...t,ref:r})})}),be=new q,Ke=new q,Jr=new q,pt=new ht;function Qr(e,t,r){const i=be.setFromMatrixPosition(e.matrixWorld);i.project(t);const c=r.width/2,a=r.height/2;return[i.x*c+c,-(i.y*a)+a]}function en(e,t){const r=be.setFromMatrixPosition(e.matrixWorld),i=Ke.setFromMatrixPosition(t.matrixWorld),c=r.sub(i),a=t.getWorldDirection(Jr);return c.angleTo(a)>Math.PI/2}function tn(e,t,r,i){const c=be.setFromMatrixPosition(e.matrixWorld),a=c.clone();a.project(t),pt.set(a.x,a.y),r.setFromCamera(pt,t);const f=r.intersectObjects(i,!0);if(f.length){const d=f[0].distance;return c.distanceTo(r.ray.origin)<d}return!0}function rn(e,t){if(t instanceof qe)return t.zoom;if(t instanceof Ve){const r=be.setFromMatrixPosition(e.matrixWorld),i=Ke.setFromMatrixPosition(t.matrixWorld),c=t.fov*Math.PI/180,a=r.distanceTo(i);return 1/(2*Math.tan(c/2)*a)}else return 1}function nn(e,t,r){if(t instanceof Ve||t instanceof qe){const i=be.setFromMatrixPosition(e.matrixWorld),c=Ke.setFromMatrixPosition(t.matrixWorld),a=i.distanceTo(c),f=(r[1]-r[0])/(t.far-t.near),d=r[1]-f*t.far;return Math.round(f*a+d)}}const Ge=e=>Math.abs(e)<1e-10?0:e;function Lt(e,t,r=""){let i="matrix3d(";for(let c=0;c!==16;c++)i+=Ge(t[c]*e.elements[c])+(c!==15?",":")");return r+i}const on=(e=>t=>Lt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),sn=(e=>(t,r)=>Lt(t,e(r),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function an(e){return e&&typeof e=="object"&&"current"in e}const On=p.forwardRef(({children:e,eps:t=.001,style:r,className:i,prepend:c,center:a,fullscreen:f,portal:d,distanceFactor:s,sprite:v=!1,transform:o=!1,occlude:n,onOcclude:l,castShadow:m,receiveShadow:g,material:E,geometry:y,zIndexRange:u=[16777271,0],calculatePosition:h=Qr,as:M="div",wrapperClass:O,pointerEvents:x="auto",..._},T)=>{const{gl:k,camera:R,scene:D,size:w,raycaster:L,events:H,viewport:X}=G(),[z]=p.useState(()=>document.createElement(M)),B=p.useRef(),W=p.useRef(null),b=p.useRef(0),C=p.useRef([0,0]),P=p.useRef(null),S=p.useRef(null),A=(d==null?void 0:d.current)||H.connected||k.domElement.parentNode,j=p.useRef(null),$=p.useRef(!1),N=p.useMemo(()=>n&&n!=="blending"||Array.isArray(n)&&n.length&&an(n[0]),[n]);p.useLayoutEffect(()=>{const U=k.domElement;n&&n==="blending"?(U.style.zIndex=`${Math.floor(u[0]/2)}`,U.style.position="absolute",U.style.pointerEvents="none"):(U.style.zIndex=null,U.style.position=null,U.style.pointerEvents=null)},[n]),p.useLayoutEffect(()=>{if(W.current){const U=B.current=wr(z);if(D.updateMatrixWorld(),o)z.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const F=h(W.current,R,w);z.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${F[0]}px,${F[1]}px,0);transform-origin:0 0;`}return A&&(c?A.prepend(z):A.appendChild(z)),()=>{A&&A.removeChild(z),U.unmount()}}},[A,o]),p.useLayoutEffect(()=>{O&&(z.className=O)},[O]);const Y=p.useMemo(()=>o?{position:"absolute",top:0,left:0,width:w.width,height:w.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:a?"translate3d(-50%,-50%,0)":"none",...f&&{top:-w.height/2,left:-w.width/2,width:w.width,height:w.height},...r},[r,a,f,w,o]),oe=p.useMemo(()=>({position:"absolute",pointerEvents:x}),[x]);p.useLayoutEffect(()=>{if($.current=!1,o){var U;(U=B.current)==null||U.render(p.createElement("div",{ref:P,style:Y},p.createElement("div",{ref:S,style:oe},p.createElement("div",{ref:T,className:i,style:r,children:e}))))}else{var F;(F=B.current)==null||F.render(p.createElement("div",{ref:T,style:Y,className:i,children:e}))}});const ie=p.useRef(!0);ye(U=>{if(W.current){R.updateMatrixWorld(),W.current.updateWorldMatrix(!0,!1);const F=o?C.current:h(W.current,R,w);if(o||Math.abs(b.current-R.zoom)>t||Math.abs(C.current[0]-F[0])>t||Math.abs(C.current[1]-F[1])>t){const ee=en(W.current,R);let K=!1;N&&(Array.isArray(n)?K=n.map(te=>te.current):n!=="blending"&&(K=[D]));const de=ie.current;if(K){const te=tn(W.current,R,L,K);ie.current=te&&!ee}else ie.current=!ee;de!==ie.current&&(l?l(!ie.current):z.style.display=ie.current?"block":"none");const we=Math.floor(u[0]/2),Wt=n?N?[u[0],we]:[we-1,0]:u;if(z.style.zIndex=`${nn(W.current,R,Wt)}`,o){const[te,et]=[w.width/2,w.height/2],Se=R.projectionMatrix.elements[5]*et,{isOrthographicCamera:tt,top:Ht,left:$t,bottom:Bt,right:Nt}=R,Ut=on(R.matrixWorldInverse),Gt=tt?`scale(${Se})translate(${Ge(-(Nt+$t)/2)}px,${Ge((Ht+Bt)/2)}px)`:`translateZ(${Se}px)`;let re=W.current.matrixWorld;v&&(re=R.matrixWorldInverse.clone().transpose().copyPosition(re).scale(W.current.scale),re.elements[3]=re.elements[7]=re.elements[11]=0,re.elements[15]=1),z.style.width=w.width+"px",z.style.height=w.height+"px",z.style.perspective=tt?"":`${Se}px`,P.current&&S.current&&(P.current.style.transform=`${Gt}${Ut}translate(${te}px,${et}px)`,S.current.style.transform=sn(re,1/((s||10)/400)))}else{const te=s===void 0?1:rn(W.current,R)*s;z.style.transform=`translate3d(${F[0]}px,${F[1]}px,0) scale(${te})`}C.current=F,b.current=R.zoom}}if(!N&&j.current&&!$.current)if(o){if(P.current){const F=P.current.children[0];if(F!=null&&F.clientWidth&&F!=null&&F.clientHeight){const{isOrthographicCamera:ee}=R;if(ee||y)_.scale&&(Array.isArray(_.scale)?_.scale instanceof q?j.current.scale.copy(_.scale.clone().divideScalar(1)):j.current.scale.set(1/_.scale[0],1/_.scale[1],1/_.scale[2]):j.current.scale.setScalar(1/_.scale));else{const K=(s||10)/400,de=F.clientWidth*K,we=F.clientHeight*K;j.current.scale.set(de,we,1)}$.current=!0}}}else{const F=z.children[0];if(F!=null&&F.clientWidth&&F!=null&&F.clientHeight){const ee=1/X.factor,K=F.clientWidth*ee,de=F.clientHeight*ee;j.current.scale.set(K,de,1),$.current=!0}j.current.lookAt(U.camera.position)}});const Qe=p.useMemo(()=>({vertexShader:o?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[o]);return p.createElement("group",J({},_,{ref:W}),n&&!N&&p.createElement("mesh",{castShadow:m,receiveShadow:g,ref:j},y||p.createElement("planeGeometry",null),E||p.createElement("shaderMaterial",{side:ar,vertexShader:Qe.vertexShader,fragmentShader:Qe.fragmentShader})))});let ve=0;const jn=yt(e=>(_e.onStart=(t,r,i)=>{e({active:!0,item:t,loaded:r,total:i,progress:(r-ve)/(i-ve)*100})},_e.onLoad=()=>{e({active:!1})},_e.onError=t=>e(r=>({errors:[...r.errors,t]})),_e.onProgress=(t,r,i)=>{r===i&&(ve=i),e({active:!0,item:t,loaded:r,total:i,progress:(r-ve)/(i-ve)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),We=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function Dt(e,t){const r=G(a=>a.gl),i=Q(Xe,We(e)?Object.values(e):e);return p.useLayoutEffect(()=>{t==null||t(i)},[t]),p.useEffect(()=>{if("initTexture"in r){let a=[];Array.isArray(i)?a=i:i instanceof Be?a=[i]:We(i)&&(a=Object.values(i)),a.forEach(f=>{f instanceof Be&&r.initTexture(f)})}},[r,i]),p.useMemo(()=>{if(We(e)){const a={};let f=0;for(const d in e)a[d]=i[f++];return a}else return i},[e,i])}Dt.preload=e=>Q.preload(Xe,e);Dt.clear=e=>Q.clear(Xe,e);const ln=()=>parseInt(lr.replace(/\D+/g,"")),Ft=ln();function cn(e){return Array.isArray(e)}function He(e=[0,0,0]){return cn(e)?e:e instanceof q||e instanceof gt?[e.x,e.y,e.z]:[e,e,e]}const Tn=p.forwardRef(function({debug:t,depthTest:r=!1,polygonOffsetFactor:i=-10,map:c,mesh:a,children:f,position:d,rotation:s,scale:v,...o},n){const l=p.useRef(null);p.useImperativeHandle(n,()=>l.current);const m=p.useRef(null);return p.useLayoutEffect(()=>{const g=(a==null?void 0:a.current)||l.current.parent,E=l.current;if(!(g instanceof cr))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const y={position:new q,rotation:new gt,scale:new q(1,1,1)};if(g){Z(y,{position:d,scale:v});const u=g.matrixWorld.clone();if(g.matrixWorld.identity(),!s||typeof s=="number"){const h=new ur;h.position.copy(y.position),h.lookAt(g.position),typeof s=="number"&&h.rotateZ(s),Z(y,{rotation:h.rotation})}else Z(y,{rotation:s});return E.geometry=new _r(g,y.position,y.rotation,y.scale),m.current&&(Z(m.current,y),m.current.traverse(h=>h.raycast=()=>null)),g.matrixWorld=u,()=>{E.geometry.dispose()}}},[a,...He(d),...He(v),...He(s)]),p.createElement("mesh",J({ref:l,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":i,"material-depthTest":r,"material-map":c},o),f,t&&p.createElement("mesh",{ref:m},p.createElement("boxGeometry",null),p.createElement("meshNormalMaterial",{wireframe:!0}),p.createElement("axesHelper",null)))});let Me=null,It="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function zt(e,t,r){return i=>{r&&r(i),e&&(Me||(Me=new Er),Me.setDecoderPath(typeof e=="string"?e:It),i.setDRACOLoader(Me)),t&&i.setMeshoptDecoder(typeof je=="function"?je():je)}}function Je(e,t=!0,r=!0,i){return Q(Ye,e,zt(t,r,i))}Je.preload=(e,t=!0,r=!0,i)=>Q.preload(Ye,e,zt(t,r,i));Je.clear=e=>Q.clear(Ye,e);Je.setDecoderPath=e=>{It=e};const An=p.forwardRef(({makeDefault:e,camera:t,regress:r,domElement:i,enableDamping:c=!0,keyEvents:a=!1,onChange:f,onStart:d,onEnd:s,...v},o)=>{const n=G(_=>_.invalidate),l=G(_=>_.camera),m=G(_=>_.gl),g=G(_=>_.events),E=G(_=>_.setEvents),y=G(_=>_.set),u=G(_=>_.get),h=G(_=>_.performance),M=t||l,O=i||g.connected||m.domElement,x=p.useMemo(()=>new Pr(M),[M]);return ye(()=>{x.enabled&&x.update()},-1),p.useEffect(()=>(a&&x.connect(a===!0?O:a),x.connect(O),()=>void x.dispose()),[a,O,r,x,n]),p.useEffect(()=>{const _=R=>{n(),r&&h.regress(),f&&f(R)},T=R=>{d&&d(R)},k=R=>{s&&s(R)};return x.addEventListener("change",_),x.addEventListener("start",T),x.addEventListener("end",k),()=>{x.removeEventListener("start",T),x.removeEventListener("end",k),x.removeEventListener("change",_)}},[f,d,s,x,n,E]),p.useEffect(()=>{if(e){const _=u().controls;return y({controls:x}),()=>y({controls:_})}},[e,x]),p.createElement("primitive",J({ref:o,object:x,enableDamping:c},v))}),$e=Ft>=154?"opaque_fragment":"output_fragment";class un extends fr{constructor(t){super(t),this.onBeforeCompile=(r,i)=>{const{isWebGL2:c}=i.capabilities;r.fragmentShader=r.fragmentShader.replace(`#include <${$e}>`,`
        ${c?`#include <${$e}>`:`#extension GL_OES_standard_derivatives : enable
#include <${$e}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${Ft>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const kn=p.forwardRef((e,t)=>{const[r]=p.useState(()=>new un(null));return p.createElement("primitive",J({},e,{object:r,ref:t,attach:"material"}))}),Ln=p.forwardRef(({children:e,enabled:t=!0,speed:r=1,rotationIntensity:i=1,floatIntensity:c=1,floatingRange:a=[-.1,.1],...f},d)=>{const s=p.useRef(null);p.useImperativeHandle(d,()=>s.current,[]);const v=p.useRef(Math.random()*1e4);return ye(o=>{var n,l;if(!t||r===0)return;const m=v.current+o.clock.getElapsedTime();s.current.rotation.x=Math.cos(m/4*r)/8*i,s.current.rotation.y=Math.sin(m/4*r)/8*i,s.current.rotation.z=Math.sin(m/4*r)/20*i;let g=Math.sin(m/4*r)/10;g=dr.mapLinear(g,-.1,.1,(n=a==null?void 0:a[0])!==null&&n!==void 0?n:-.1,(l=a==null?void 0:a[1])!==null&&l!==void 0?l:.1),s.current.position.y=g*c,s.current.updateMatrix()}),p.createElement("group",f,p.createElement("group",{ref:s,matrixAutoUpdate:!1},e))});let ne,he;const fn=p.createContext(null),mt=new pr,vt=new q,dn=p.forwardRef(({children:e,range:t,limit:r=1e3,...i},c)=>{const a=p.useRef(null);p.useImperativeHandle(c,()=>a.current,[]);const[f,d]=p.useState([]),[[s,v,o]]=p.useState(()=>[new Float32Array(r*3),Float32Array.from({length:r*3},()=>1),Float32Array.from({length:r},()=>1)]);p.useEffect(()=>{a.current.geometry.attributes.position.needsUpdate=!0}),ye(()=>{for(a.current.updateMatrix(),a.current.updateMatrixWorld(),mt.copy(a.current.matrixWorld).invert(),a.current.geometry.drawRange.count=Math.min(r,t!==void 0?t:r,f.length),ne=0;ne<f.length;ne++)he=f[ne].current,he.getWorldPosition(vt).applyMatrix4(mt),vt.toArray(s,ne*3),a.current.geometry.attributes.position.needsUpdate=!0,he.matrixWorldNeedsUpdate=!0,he.color.toArray(v,ne*3),a.current.geometry.attributes.color.needsUpdate=!0,o.set([he.size],ne),a.current.geometry.attributes.size.needsUpdate=!0});const n=p.useMemo(()=>({getParent:()=>a,subscribe:l=>(d(m=>[...m,l]),()=>d(m=>m.filter(g=>g.current!==l.current)))}),[]);return p.createElement("points",J({userData:{instances:f},matrixAutoUpdate:!1,ref:a,raycast:()=>null},i),p.createElement("bufferGeometry",null,p.createElement("bufferAttribute",{attach:"attributes-position",count:s.length/3,array:s,itemSize:3,usage:ue}),p.createElement("bufferAttribute",{attach:"attributes-color",count:v.length/3,array:v,itemSize:3,usage:ue}),p.createElement("bufferAttribute",{attach:"attributes-size",count:o.length,array:o,itemSize:1,usage:ue})),p.createElement(fn.Provider,{value:n},e))}),pn=p.forwardRef(({children:e,positions:t,colors:r,sizes:i,stride:c=3,...a},f)=>{const d=p.useRef(null);return p.useImperativeHandle(f,()=>d.current,[]),ye(()=>{const s=d.current.geometry.attributes;s.position.needsUpdate=!0,r&&(s.color.needsUpdate=!0),i&&(s.size.needsUpdate=!0)}),p.createElement("points",J({ref:d},a),p.createElement("bufferGeometry",null,p.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/c,array:t,itemSize:c,usage:ue}),r&&p.createElement("bufferAttribute",{attach:"attributes-color",count:r.length/c,array:r,itemSize:3,usage:ue}),i&&p.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/c,array:i,itemSize:1,usage:ue})),e)}),Dn=p.forwardRef((e,t)=>e.positions instanceof Float32Array?p.createElement(pn,J({},e,{ref:t})):p.createElement(dn,J({},e,{ref:t})));function Fn({all:e,scene:t,camera:r}){const i=G(({gl:f})=>f),c=G(({camera:f})=>f),a=G(({scene:f})=>f);return p.useLayoutEffect(()=>{const f=[];e&&(t||a).traverse(v=>{v.visible===!1&&(f.push(v),v.visible=!0)}),i.compile(t||a,r||c);const d=new mr(128);new vr(.01,1e5,d).update(i,t||a),d.dispose(),f.forEach(v=>v.visible=!1)},[]),null}export{Rn as C,Tn as D,Ln as F,On as H,An as O,Fn as P,Sn as _,Cn as a,Dn as b,kn as c,jn as d,Je as e,Dt as f,xn as g,ye as u};
